<!DOCTYPE html>
<html lang="en" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaQMS Admin Control Panel</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: right;
        }

        h1 {
            color: #1f2937;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-bottom: 1rem;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-success {
            background-color: #10b981;
            color: white;
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .status-box {
            background-color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            margin-bottom: 1.5rem;
            font-family: monospace;
            direction: ltr;
            text-align: left;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #374151;
        }

        select,
        input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-sizing: border-box;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>PharmaQMS Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>

        <div class="status-box" id="currentStatus">
            Checking status...
        </div>

        <div>
            <label class="label">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø§Ù„ØªØ±Ø®ÙŠØµ)</label>
            <select id="validityDuration">
                <option value="30">30 ÙŠÙˆÙ… (Ø´Ù‡Ø±)</option>
                <option value="90">90 ÙŠÙˆÙ… (3 Ø´Ù‡ÙˆØ±)</option>
                <option value="365" selected>365 ÙŠÙˆÙ… (Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø©)</option>
                <option value="1095">3 Ø³Ù†ÙˆØ§Øª</option>
                <option value="3650">Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø© (10 Ø³Ù†ÙˆØ§Øª)</option>
            </select>
            <button class="btn btn-success" onclick="grantValidity()">âœ… Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© / ØªÙØ¹ÙŠÙ„</button>
        </div>

        <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid #e5e7eb;">

        <div>
            <label class="label">Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</label>
            <button class="btn btn-primary" onclick="repairLogin()">ğŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Reset Admin)</button>
            <button class="btn btn-danger" onclick="forceLogout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ</button>
        </div>
    </div>

    <script>
        function updateStatus() {
            const user = localStorage.getItem('currentUser');
            const expiry = localStorage.getItem('sessionExpiry');

            let statusHtml = "<strong>Current State:</strong><br>";

            if (user) {
                try {
                    const u = JSON.parse(user);
                    statusHtml += `User: <span style="color:green">${u.username}</span><br>`;
                    statusHtml += `Role: ${u.role}<br>`;
                } catch (e) { statusHtml += `User: <span style="color:red">Invalid JSON</span><br>`; }
            } else {
                statusHtml += `User: <span style="color:red">Not Logged In</span><br>`;
            }

            if (expiry) {
                const expDate = new Date(expiry);
                const now = new Date();
                const color = expDate > now ? 'green' : 'red';
                statusHtml += `Expiry: <span style="color:${color}">${expDate.toLocaleString()}</span>`;
            } else {
                statusHtml += `Expiry: <span style="color:red">None</span>`;
            }

            document.getElementById('currentStatus').innerHTML = statusHtml;
        }

        function grantValidity() {
            const days = parseInt(document.getElementById('validityDuration').value);
            const now = new Date();
            const expiry = new Date(now.getTime() + (days * 24 * 60 * 60 * 1000));

            let user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) {
                // Create default admin if not exists
                user = {
                    id: "1",
                    username: "admin",
                    name: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…",
                    role: "admin",
                    department: "IT",
                    permissions: ["*"],
                    lastLogin: now
                };
            }

            user.sessionExpiry = expiry;

            localStorage.setItem('currentUser', JSON.stringify(user));
            localStorage.setItem('sessionExpiry', expiry.toISOString());

            alert(`ØªÙ… Ù…Ù†Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!\nØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${expiry.toLocaleDateString()}`);
            updateStatus();
        }

        function repairLogin() {
            const now = new Date();
            const expiry = new Date(now.getTime() + (365 * 24 * 60 * 60 * 1000)); // Default 1 year for repair

            const adminUser = {
                id: "1",
                username: "admin",
                name: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…",
                role: "admin",
                department: "IT",
                permissions: ["*"],
                lastLogin: now,
                sessionExpiry: expiry
            };

            localStorage.setItem('currentUser', JSON.stringify(adminUser));
            localStorage.setItem('sessionExpiry', expiry.toISOString());

            alert("ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù†.");
            updateStatus();
        }

        function forceLogout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('sessionExpiry');
            localStorage.removeItem('activityLog');
            alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆÙ…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.");
            updateStatus();
        }

        // Initial check
        updateStatus();
    </script>
</body>

</html>